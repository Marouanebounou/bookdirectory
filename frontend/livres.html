<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Livres - Bibliothèque Numérique</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: white;
        padding: 1rem 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        z-index: 1000;
    }

    .books-container {
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
        margin-top: 60px; /* Add margin to account for fixed header */
    }

    .search-section {
        margin-bottom: 2rem;
        background: white;
        padding: 2.5rem 1.5rem; /* Increased top and bottom padding */
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 1;
    }

    .search-box {
      max-width: 500px;
      margin: 0 auto;
    }

    .search-input {
      width: 100%;
      padding: 1.2rem; /* Slightly increased padding */
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }

    .search-input:focus {
      border-color: #4a5568;
      outline: none;
    }

    .books-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .book-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    .book-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
    }

    .book-image {
      position: relative;
      height: 400px;
      overflow: hidden;
    }

    .book-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .book-card:hover .book-image img {
      transform: scale(1.05);
    }

    .book-info {
      padding: 1.5rem;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    .book-info h3 {
      margin: 0 0 0.5rem;
      color: #2d3748;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .book-info .author {
      color: #718096;
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    .book-info .description {
      color: #4a5568;
      margin-bottom: 1.5rem;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .book-actions {
      margin-top: auto;
      display: flex;
      gap: 1rem;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-read {
      background: #4a5568;
      color: white;
      flex: 1;
    }

    .btn-download {
      background: #2d3748;
      color: white;
      flex: 1;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    .no-books {
      text-align: center;
      padding: 3rem;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .no-books i {
      font-size: 3rem;
      color: #718096;
      margin-bottom: 1rem;
    }

    .no-books p {
      color: #4a5568;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="nav-brand">
      <i class="fas fa-book-reader"></i>
      <span>Bibliothèque Numérique</span>
    </div>
    <div class="nav-links">
      <a href="index.html">Accueil</a>
      <a href="livres.html" class="active">Livres</a>
      <a href="about.html">À Propos</a>
      <a href="contact.html">Contact</a>
    </div>
    <div class="nav-actions">
      <div id="userSection" style="display: none;">
        <span id="userName"></span>
        <button class="btn btn-outline" onclick="handleLogout()">Déconnexion</button>
      </div>
      <div id="guestSection">
        <a href="signin.html"><button class="btn btn-outline">Connexion</button></a>
        <a href="signup.html"><button class="btn btn-primary">S'inscrire</button></a>
      </div>
    </div>
  </nav>

  <div class="books-container">
    <div class="search-section">
      <div class="search-box">
        <input type="text" id="searchInput" class="search-input" placeholder="Rechercher un livre..." oninput="filterBooks()">
      </div>
    </div>

    <div class="books-grid" id="booksGrid">
      <!-- Books will be dynamically added here -->
    </div>
  </div>

  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>À propos</h3>
        <p>Votre bibliothèque numérique de confiance, offrant un accès facile à des milliers de livres.</p>
      </div>
      <div class="footer-section">
        <h3>Liens Rapides</h3>
        <ul>
          <li><a href="index.html">Accueil</a></li>
          <li><a href="livres.html">Livres</a></li>
          <li><a href="about.html">À Propos</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Contact</h3>
        <ul>
          <li><i class="fas fa-envelope"></i> contact@bibliotheque.fr</li>
          <li><i class="fas fa-phone"></i> +33 1 23 45 67 89</li>
          <li><i class="fas fa-map-marker-alt"></i> Paris, France</li>
        </ul>
      </div>
      <div class="footer-section">
        <h3>Suivez-nous</h3>
        <div class="social-links">
          <a href="#"><i class="fab fa-facebook"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-linkedin"></i></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 Bibliothèque Numérique. Tous droits réservés.</p>
    </div>
  </footer>

  <script src="js/auth.js"></script>
  <script>
    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      updateAuthUI();
      displayBooks();
    });

    function updateAuthUI() {
      const userSection = document.getElementById('userSection');
      const guestSection = document.getElementById('guestSection');
      const userName = document.getElementById('userName');
      if (library.currentUser) {
        userSection.style.display = 'flex';
        guestSection.style.display = 'none';
        userName.textContent = `Bonjour, ${library.currentUser.username}`;
      } else {
        userSection.style.display = 'none';
        guestSection.style.display = 'flex';
      }
    }

    function handleLogout() {
      library.logout();
      window.location.reload();
    }

    // Function to display books from backend
    async function displayBooks() {
      try {
        const response = await fetch('http://localhost:5000/api/books');
        const books = await response.json();
        const booksGrid = document.getElementById('booksGrid');
        booksGrid.innerHTML = '';
        if (books.length === 0) {
          booksGrid.innerHTML = `
            <div class="no-books">
              <i class="fas fa-books"></i>
              <p>Aucun livre disponible pour le moment.</p>
            </div>
          `;
          return;
        }
        books.forEach(book => {
          const bookCard = document.createElement('div');
          bookCard.className = 'book-card';
          bookCard.innerHTML = `
            <div class="book-image">
              <img src="http://localhost:5000/${book.imageUrl}" alt="${book.name}">
            </div>
            <div class="book-info">
              <h3>${book.name}</h3>
              <p class="author">${book.author}</p>
              <p class="description">${book.description}</p>
              <div class="book-actions">
                <a href="book.html?id=${book._id}" class="btn btn-read">
                  <i class="fas fa-book-open"></i> Lire
                </a>
                <a href="http://localhost:5000/${book.pdfUrl}" download class="btn btn-download">
                  <i class="fas fa-download"></i> Télécharger
                </a>
              </div>
            </div>
          `;
          booksGrid.appendChild(bookCard);
        });
      } catch (error) {
        console.error('Error fetching books:', error);
      }
    }

    // Search/filter books on the DOM
    function filterBooks() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const bookCards = document.querySelectorAll('.book-card');
      let hasResults = false;
      bookCards.forEach(card => {
        const title = card.querySelector('h3').textContent.toLowerCase();
        const author = card.querySelector('.author').textContent.toLowerCase();
        const description = card.querySelector('.description').textContent.toLowerCase();
        if (title.includes(searchTerm) || author.includes(searchTerm) || description.includes(searchTerm)) {
          card.style.display = 'flex';
          hasResults = true;
        } else {
          card.style.display = 'none';
        }
      });
      // Show no results message if no books match the search
      let noResults = document.getElementById('noResults');
      if (!hasResults) {
        if (!noResults) {
          const noResultsDiv = document.createElement('div');
          noResultsDiv.id = 'noResults';
          noResultsDiv.className = 'no-books';
          noResultsDiv.innerHTML = `
            <i class="fas fa-search"></i>
            <p>Aucun livre ne correspond à votre recherche.</p>
          `;
          document.getElementById('booksGrid').appendChild(noResultsDiv);
        }
      } else if (noResults) {
        noResults.remove();
      }
    }

    // Add event listener for search with debounce
    let searchTimeout;
    document.getElementById('searchInput').addEventListener('input', function(e) {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        filterBooks();
      }, 300);
    });
  </script>
</body>
</html> 